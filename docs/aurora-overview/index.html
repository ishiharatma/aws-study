
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Aurora</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="G-01ZZ95D1K9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="aurora-overview"
                  title="Aurora"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="はじめに" duration="0">
        <p>本ページは、AWS に関する個人の勉強および勉強会で使用することを目的に、AWS ドキュメントなどを参照し作成しておりますが、記載の誤り等が含まれる場合がございます。</p>
<p>最新の情報については、AWS 公式ドキュメントをご参照ください。</p>


      </google-codelab-step>
    
      <google-codelab-step label="Contents" duration="1">
        <ul>
<li><a href="#aurora" target="_blank">Aurora</a><ul>
<li><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB" target="_blank">はじめに</a></li>
<li><a href="#contents" target="_blank">Contents</a></li>
<li><a href="#aurora-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9F%A5%E3%82%8B%E3%81%AB%E3%81%AF" target="_blank">Aurora について知るには</a></li>
<li><a href="#aurora-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9F%A5%E3%82%8B%E3%81%AB%E3%81%AF%E3%81%9D%E3%81%AE%E4%BB%96" target="_blank">Aurora について知るには(その他)</a></li>
<li><a href="#aurora-%E3%81%A8%E3%81%AF" target="_blank">Aurora とは</a></li>
<li><a href="#%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%B3" target="_blank">サポートされているデータベースエンジン</a></li>
<li><a href="#aurora-%E3%81%AE%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E6%A7%8B%E6%88%90" target="_blank">Aurora の基本的な構成</a></li>
<li><a href="#sla" target="_blank">SLA</a></li>
<li><a href="#%E5%8F%AF%E7%94%A8%E6%80%A7" target="_blank">可用性</a><ul>
<li><a href="#%E5%8D%98%E4%B8%80%E6%A7%8B%E6%88%90" target="_blank">単一構成</a></li>
<li><a href="#%E3%83%AC%E3%83%97%E3%83%AA%E3%82%AB%E6%A7%8B%E6%88%90" target="_blank">レプリカ構成</a></li>
</ul>
</li>
<li><a href="#%E3%83%AC%E3%83%97%E3%83%AA%E3%82%AB%E3%81%AE%E6%98%87%E6%A0%BC" target="_blank">レプリカの昇格</a><ul>
<li><a href="#aurora-%E3%81%AE%E3%82%AF%E3%83%AD%E3%82%B9%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%83%AC%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3" target="_blank">Aurora のクロスリージョンレプリケーション</a></li>
</ul>
</li>
<li><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%97" target="_blank">インスタンスタイプ</a></li>
<li><a href="#%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%80%E3%82%A6%E3%83%B3" target="_blank">スケールアップ/ダウン</a></li>
<li><a href="#%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E3%81%AE%E8%87%AA%E5%8B%95%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0" target="_blank">ストレージの自動スケーリング</a></li>
<li><a href="#aurora-%E3%81%AE%E3%83%AD%E3%82%B0" target="_blank">Aurora のログ</a></li>
<li><a href="#serverless" target="_blank">Serverless</a></li>
<li><a href="#bluegreen-deploymentsnew-2022-11-27" target="_blank">Blue/Green Deployments(New: 2022-11-27)</a></li>
</ul>
</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Aurora について知るには" duration="203">
        <p>【AWS Black Belt Online Seminar】<a href="https://youtu.be/VerVNchaqVY" target="_blank">Amazon Aurora MySQL(YouTube)</a>(55:41)</p>
<p class="image-container"><img alt="blackbelt-aurora-mysql" src="img\\91557b1bfa29d31.jpg"></p>
<p>【AWS Black Belt Online Seminar】<a href="https://www.youtube.com/watch?v=9KQkskyP930" target="_blank">Amazon Aurora MySQL Compatible Edition ユースケース毎のスケーリング手法</a>(55:41)</p>
<p class="image-container"><img alt="blackbelt-aurora-mysql-usecase" src="img\\b6c3964ce815c10b.jpg"></p>
<p>【AWS Black Belt Online Seminar】<a href="https://youtu.be/oJqIzHIMh7Q" target="_blank">Amazon Aurora with PostgreSQL Compatibility(YouTube)</a>(1:03:46)</p>
<p class="image-container"><img alt="blackbelt-aurora-postgresql" src="img\\c8016177b8680d56.jpg"></p>
<p><a href="https://youtu.be/8uPU2T5Xj9E" target="_blank">RDS/Aurora Update | 2.5時間で学ぶ！ Amazon Aurora のいま(YouTube)</a>(27:33)</p>
<p class="image-container"><img alt="rds-aurora-updates" src="img\\eb2909ec59c46dfe.jpg"></p>
<p><a href="https://aws.amazon.com/jp/rds/aurora/" target="_blank">Amazon Aurora サービス概要</a></p>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/CHAP_AuroraOverview.html" target="_blank">Amazon Aurora ドキュメント</a></p>
<p><a href="https://aws.amazon.com/jp/rds/aurora/faqs/" target="_blank">Amazon Aurora よくある質問</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Aurora について知るには(その他)" duration="186">
        <p>【AWS Summit Tokyo 2019】<a href="https://www.youtube.com/watch?v=h1r8AzOdlqo" target="_blank">AWS におけるデータベースの選択指針</a>(39:25)</p>
<p class="image-container"><img alt="aws-summit-2019-c2-03" src="img\\49298d1b9cdedb44.jpg"></p>
<p>【AWS Summit Tokyo 2019】<a href="https://www.youtube.com/watch?v=3oMR2hglQR0" target="_blank">Amazon RDS におけるパフォーマンス最適化とパフォーマンス管理</a>(41:33)</p>
<p class="image-container"><img alt="aws-summit-2019-b3-04" src="img\\2be056bcc1f56ecc.jpg"></p>
<p>【AWS Summit Tokyo 2019】<a href="https://www.youtube.com/watch?v=5McG3hJae9A" target="_blank">Amazon Aurora with PostgreSQL Compatibility における運用設計のファーストステップ</a>(39:53)</p>
<p class="image-container"><img alt="aws-summit-2019-b3-05" src="img\\359bb8f2e1daa346.jpg"></p>
<p>【AWS Summit Tokyo 2019】<a href="https://www.youtube.com/watch?v=DrtwAOND1Pc" target="_blank">Amazon Aurora storage demystified: How it all works (DAT309-R)</a>(1:04:45)</p>
<p class="image-container"><img alt="aws-summit-2019-dat309-r" src="img\\f23b8d10aa213d9e.jpg"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Aurora とは" duration="1">
        <p>MySQL および PostgreSQL と互換性のあるクラウド向けのリレーショナルデータベースを提供するフルマネージドサービスです。</p>
<p>マネジメントコンソールからわずか数クリックで冗長化、バックアップなどが設定されたデータベースを作成できます。</p>


      </google-codelab-step>
    
      <google-codelab-step label="サポートされているデータベースエンジン" duration="1">
        <ul>
<li>PostgreSQL(互換)</li>
<li>MySQL(互換)</li>
</ul>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Aurora.VersionPolicy.html#Aurora.VersionPolicy.MajorVersions" target="_blank">Amazon Aurora メジャーバージョン</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Aurora の基本的な構成" duration="5">
        <p>RDS とは異なり、Aurora では DB インスタンスとストレージが分離されています。これにより、RDS の 2倍の性能を発揮すると言われています。</p>
<p class="image-container"><img alt="aurora-architecture" src="img\\7f8f6206f56d1ad7.png"></p>
<p>Aurora を構成する要素は次の通りです。</p>
<ul>
<li>Aurora DB クラスター <ul>
<li>DB インスタンスとクラスタボリューム</li>
</ul>
</li>
<li>DB インスタンス</li>
<li>クラスタボリューム</li>
</ul>
<p class="image-container"><img alt="aurora" src="img\\7fcfe9433d55987d.png"></p>
<p>データベースを作成すると、Writer と Reader のエンドポイントと呼ばれる専用の DNS 名が発行されます。</p>
<p>アプリケーションは、エンドポイントに接続して、データベースへの操作を行います。</p>
<p>このエンドポイントは、各データベースエンジンの接続ポートのみ接続することができます。</p>


      </google-codelab-step>
    
      <google-codelab-step label="SLA" duration="1">
        <p><a href="https://aws.amazon.com/jp/rds/aurora/sla/" target="_blank">Amazon Aurora Service Level Agreement</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="可用性" duration="5">
        <h2 is-upgraded>単一構成</h2>
<p>１つの AZ に プライマリインスタンスを構築した最小構成です。 AZ 障害時にはインスタンスが利用できなくなります。</p>
<p class="image-container"><img alt="aurora-single" src="img\\ceb0278a1815cfed.png"></p>
<p>開発環境や、可用性を求められない場合にコストを低く抑えることが出来る構成です。インスタンスの障害であれば、同じ AZ 内に新規インスタンスが作成され、10分以内に復旧します。AZ 障害時にはフェールオーバーが失敗する可能性があります。</p>
<p>エンドポイントは Writer と Reader のエンドポイントが自動的に作成されますが、レプリカがない場合は、Reader エンドポイントは プライマリインスタンスに接続します。</p>
<p>読み取りスループットを向上させたい場合は、レプリカを追加します。</p>
<h2 is-upgraded>レプリカ構成</h2>
<p>読み取り頻度の高いデータベースのワークロードに対して、スケールアウトすることにより、パフォーマンスを向上させます。また、プライマリインスタンスに障害が発生した場合は、レプリカにフェールオーバーすることで自動的に復旧します。</p>
<p>レプリカは最大で 15台まで追加することが可能です。</p>
<p>レプリカへのレプリケーションは非同期で行われます。</p>
<p>エンドポイントは Writer と Reader のエンドポイントが自動的に作成され、Reader エンドポイントは レプリカに負荷分散します。</p>
<p>レプリカのインスタンスタイプがプライマリインスタンスよりも小さい場合、負荷に耐えられないことがあります。ベストプラクティスはクラスター内のすべてのインスタンスを同じサイズにすることです。</p>
<p>リードレプリカは一部のデータベースエンジンを除いて、別リージョンでも作成することができます。（クロスリージョンレプリカ：CRR）</p>
<table>
<tr><td colspan="1" rowspan="1"><p>DB エンジン</p>
</td><td colspan="1" rowspan="1"><p>レプリカ作成可？</p>
</td><td colspan="1" rowspan="1"><p>CRR可能？</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>PostgreSQL</p>
</td><td colspan="2" rowspan="1"><p>○</p>
</td><td colspan="1" rowspan="1"></td></tr>
<tr><td colspan="1" rowspan="1"><p>MySQL</p>
</td><td colspan="1" rowspan="1"><p>○</p>
</td><td colspan="1" rowspan="1"><p>○</p>
</td></tr>
</table>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Aurora.Replication.html#Aurora.Replication.Replicas" target="_blank">Aurora レプリカ</a></p>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Aurora.Replication.html#Aurora.Replication.AuroraPostgreSQL" target="_blank">Aurora PostgreSQL でのレプリケーション</a></p>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Aurora.Replication.html#Aurora.Replication.AuroraMySQL" target="_blank">Aurora MySQL でのレプリケーション</a></p>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Replication.CrossRegion.html" target="_blank">AWS リージョン 間での Amazon Aurora MySQL DB クラスターのレプリケーション</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="レプリカの昇格" duration="5">
        <p>レプリカを手動でフェールオーバーさせることで、プライマリインスタンスに昇格させることができます。</p>
<p><a href="https://aws.amazon.com/jp/premiumsupport/knowledge-center/aurora-mysql-read-replicas/" target="_blank">Amazon Aurora でリードレプリカを使用するときの一般的な問題を解決するにはどうすればよいですか？</a></p>
<h2 is-upgraded>Aurora のクロスリージョンレプリケーション</h2>
<p>RDS のクロスリージョンレプリケーションとは違い、Aurora ではストレージのみがレプリケーションされます。</p>
<p>クロスリージョン自動バックアップは、レプリケーション先のリージョンに自動スナップショットとトランザクションログのバックアップが保存されます。</p>
<p>本機能によって、災害対策（DR）が求められるシステムにおいて、リージョン障害が発生してもバックアップが作成されたリージョンでリストアを行うことで迅速に復旧することができます。</p>
<p>ただし、リージョンを跨いだストレージ料金やデータ転送（スナップショットとトランザクションログ）が必要です。</p>
<p>また、送信元と送信先のリージョンのサポートも確認しておく必要があります。</p>
<p>日本に存在するリージョンでは、東京リージョンはサポートするリージョンは多いですが、大阪リージョンでは東京のみとなっています。</p>
<ul>
<li>アジアパシフィック (東京) <ul>
<li>⇒アジアパシフィック (大阪)</li>
<li>⇒アジアパシフィック (ソウル)</li>
<li>⇒アジアパシフィック (シンガポール)</li>
<li>⇒米国東部 (バージニア北部)</li>
<li>⇒米国東部 (オハイオ)</li>
<li>⇒米国西部 (オレゴン)</li>
</ul>
</li>
<li>アジアパシフィック (大阪) <ul>
<li>⇒アジアパシフィック (東京)</li>
</ul>
</li>
</ul>
<p>参考＞<a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_ReplicateBackups.html#USER_ReplicateBackups.RegionVersionAvailability" target="_blank">送信元と送信先 AWS リージョン サポート</a></p>
<p>クロスリージョン自動バックアップがサポートされているデータベースエンジンは以下の通りです。</p>
<table>
<tr><td colspan="1" rowspan="1"><p>DB エンジン</p>
</td><td colspan="1" rowspan="1"><p>CR自動バックアップ作成可？</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>PostgreSQL</p>
</td><td colspan="1" rowspan="1"><p>○</p>
</td></tr>
<tr><td colspan="2" rowspan="1"><p>MySQL</p>
</td><td colspan="1" rowspan="1"></td></tr>
<tr><td colspan="1" rowspan="1"><p>Oracle</p>
</td><td colspan="1" rowspan="1"><p>○</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Microsoft SQL Server</p>
</td><td colspan="1" rowspan="1"><p>○</p>
</td></tr>
<tr><td colspan="2" rowspan="1"><p>MariaDB</p>
</td><td colspan="1" rowspan="1"></td></tr>
</table>
<p>参考＞<a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Concepts.RDS_Fea_Regions_DB-eng.Feature.CrossRegionAutomatedBackups.html" target="_blank">クロスリージョン自動バックアップ</a></p>
<p>参考＞<a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_ReplicateBackups.html" target="_blank">別の AWS リージョン への自動バックアップのレプリケーション</a></p>
<p>参考＞<a href="https://aws.amazon.com/jp/blogs/news/best-practices-for-amazon-rds-for-postgresql-cross-region-read-replicas/" target="_blank">Amazon RDS for PostgreSQL クロスリージョンリードレプリカのためのベストプラクティス</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="インスタンスタイプ" duration="1">
        <p>RDS のインスタンスタイプは、「db.m6g.large」のように <code>db</code> から始まります。それ以降は、EC2 のインスタンスタイプと同じ構成となっています。</p>
<p><a href="https://aws.amazon.com/jp/rds/aurora/pricing/" target="_blank">Amazon Aurora の料金</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="スケールアップ/ダウン" duration="1">
        <p>DB インスタンスはインスタンスタイプを変更することができます。インスタンスタイプの変更ではダウンタイムが発生します。</p>
<p>インスタンスタイプの変更は、マネジメントコンソールや AWS CLI を使って手動で追加することができます。変更を適用するには、「すぐに適用」か「次に予定されるメンテナンスウィンドウ中」を選択できます。</p>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Aurora.Modifying.html#Aurora.Modifying.Settings" target="_blank">[すぐに適用] で使用できる設定</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="ストレージの自動スケーリング" duration="5">
        <p>クラスタボリュームはデータベースのデータ量が増えるにつれて自動的に増加します。データが削除された場合は、データに割り当てられていた領域が解放され、ストレージ料金を最小限に抑えることができます。</p>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Aurora.Overview.StorageReliability.html#aurora-storage-growth" target="_blank">Aurora ストレージのサイズを自動的に変更する方法</a></p>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Aurora.Managing.Performance.html#Aurora.Managing.Performance.StorageScaling" target="_blank">ストレージのスケーリング</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Aurora のログ" duration="5">
        <p>オンプレミスのデータベースでは、データベースのログはファイルシステムに存在します。ログが必要であれば、サーバーにログインすることでログを取得することができました。</p>
<p>Aurora でも、データベースのログは Aurora のサーバー内のファイルにシステムに存在します。ただし、Aurora ではデータベースサーバに SSH などで直接ログインできないため、取得できません。</p>
<p>そのため、Aurora では CloudWatch Logs にログをエクスポートする機能をもっています。</p>
<p>CloudWatch Logs にエクスポートすることで、ログの検索やサブスクリプションフィルターによる検知を行うことが可能になります。</p>
<p>データベースエンジンごとの保存できるログファイルの種類は次の通りです。</p>
<table>
<tr><td colspan="1" rowspan="1"><p>DB エンジン</p>
</td><td colspan="1" rowspan="1"><p>ログファイル</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>PostgreSQL</p>
</td><td colspan="1" rowspan="1"><p>Postgresql ログ、アップグレードログ</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>MySQL</p>
</td><td colspan="1" rowspan="1"><p>監査ログ、全般ログ、スロークエリログ</p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="Serverless" duration="0">
        

      </google-codelab-step>
    
      <google-codelab-step label="Blue/Green Deployments(New: 2022-11-27)" duration="0">
        <p><a href="https://aws.amazon.com/jp/blogs/aws/new-fully-managed-blue-green-deployments-in-amazon-aurora-and-amazon-rds/" target="_blank">New – Fully Managed Blue/Green Deployments in Amazon Aurora and Amazon RDS</a></p>
<p><a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/blue-green-deployments.html" target="_blank">Using Amazon RDS Blue/Green Deployments for database updates</a></p>
<p class="image-container"><img alt="blue-green-deployment" src="img\\9598ff7d75b35fbb.png"></p>
<p>データベースの切り替えを安全に行えるようになるマネージドサービスです。</p>
<p>以下のような機能が提供されています。ステージング環境（Green）でテストを行い、適切なタイミングで本番環境（Blue）と切り替えを行った後で、万が一新しい環境で問題が発生してもすぐに切り戻しが可能になります。</p>
<ul>
<li>本番環境をコピーしたステージング環境</li>
<li>本番環境とステージング環境のレプリケーション</li>
<li>本番環境に影響を与えず、ステージング環境に変更を加えることが可能 <ul>
<li>データベースのメジャーバージョンのアップグレード</li>
<li>データベースパラメータ変更</li>
<li>スキーマ変更　など。</li>
</ul>
</li>
<li>切り替えは1分以内</li>
<li>デーア損失なし</li>
<li>アプリケーションの変更不要</li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
