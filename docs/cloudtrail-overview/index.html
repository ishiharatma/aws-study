
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>AWS CloudTrail</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="G-01ZZ95D1K9"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="cloudtrail-overview"
                  title="AWS CloudTrail"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="â˜˜ï¸ ã¯ã˜ã‚ã«" duration="0">
        <p>æœ¬ãƒšãƒ¼ã‚¸ã¯ã€AWS ã«é–¢ã™ã‚‹å€‹äººã®å‹‰å¼·ãŠã‚ˆã³å‹‰å¼·ä¼šã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã«ã€AWS ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãªã©ã‚’å‚ç…§ã—ä½œæˆã—ã¦ãŠã‚Šã¾ã™ãŒã€è¨˜è¼‰ã®èª¤ã‚Šç­‰ãŒå«ã¾ã‚Œã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚</p>
<p>æœ€æ–°ã®æƒ…å ±ã«ã¤ã„ã¦ã¯ã€AWS å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”å‚ç…§ãã ã•ã„ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="ğŸ‘€ Contents" duration="0">
        <ul>
<li><a href="#cloudtrail-%E3%81%A8%E3%81%AF" target="_blank">CloudTrail ã¨ã¯</a></li>
<li><a href="#cloudtrail-%E3%81%AE%E5%9F%BA%E6%9C%AC" target="_blank">CloudTrail ã®åŸºæœ¬</a></li>
<li><a href="#%E7%AE%A1%E7%90%86%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88" target="_blank">ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆ</a></li>
<li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88" target="_blank">ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆ</a></li>
<li><a href="#cloudtrail-%E3%83%AD%E3%82%B0%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%81%AE%E5%BD%A2%E5%BC%8F" target="_blank">CloudTrail ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«åã®å½¢å¼</a></li>
<li><a href="#%E3%83%AD%E3%82%B0%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88" target="_blank">ãƒ­ã‚°ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</a></li>
<li><a href="#%E7%9B%A3%E8%A6%96%E3%81%99%E3%82%8B%E4%B8%BB%E8%A6%81%E3%81%AA%E3%83%AD%E3%82%B0" target="_blank">ç›£è¦–ã™ã‚‹ä¸»è¦ãªãƒ­ã‚°</a></li>
<li><a href="#aws-cloudtrail-%E3%83%AD%E3%82%B0%E3%81%AE%E3%82%AF%E3%82%A8%E3%83%AA%E3%81%AE-athena-%E3%81%AB%E3%82%88%E3%82%8B%E5%88%86%E6%9E%90" target="_blank">AWS CloudTrail ãƒ­ã‚°ã®ã‚¯ã‚¨ãƒªã® Athena ã«ã‚ˆã‚‹åˆ†æ</a></li>
<li><a href="#cloudtrail-lake" target="_blank">CloudTrail Lake</a></li>
<li><a href="#-%E3%81%BE%E3%81%A8%E3%82%81" target="_blank">ğŸ“– ã¾ã¨ã‚</a></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="CloudTrail ã¨ã¯" duration="60">
        <p>CloudTrail ã¯ã€AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¬ãƒãƒŠãƒ³ã‚¹ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã€é‹ç”¨ç›£æŸ»ã€ãƒªã‚¹ã‚¯ç›£æŸ»ã‚’è¡Œã†ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’ãƒ­ã‚°è¨˜éŒ²ã—ã€ç¶™ç¶šçš„ã«ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã§ãã¾ã™ã€‚</p>
<p>ã€AWS Black Belt Online Seminarã€‘<a href="https://www.youtube.com/watch?v=_mmZa1Blxc4" target="_blank">AWS CloudTrail(YouTube)</a>(59:46)</p>
<p class="image-container"><img alt="blackbelt-cloudtrail" src="img\\2770f22f6e228d4e.jpg"></p>
<p><a href="https://aws.amazon.com/jp/cloudtrail/" target="_blank">CloudTrail ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦</a></p>
<p><a href="https://docs.aws.amazon.com/ja_jp/cloudtrail/?id=docs_gateway" target="_blank">CloudTrail ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></p>
<p><a href="https://aws.amazon.com/jp/cloudtrail/faqs/" target="_blank">CloudTrail ã‚ˆãã‚ã‚‹è³ªå•</a></p>
<p><a href="https://aws.amazon.com/jp/cloudtrail/pricing/" target="_blank">CloudTrail ã®æ–™é‡‘</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="CloudTrail ã®åŸºæœ¬" duration="2">
        <p>CloudTrail ã§è¨˜éŒ²ã§ãã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</p>
<ul>
<li>ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆ <ul>
<li>AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒªã‚½ãƒ¼ã‚¹ã§å®Ÿè¡Œã•ã‚Œã‚‹ç®¡ç†ãŠã‚ˆã³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ“ä½œã® API ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</li>
<li>ä¾‹ï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®è¨­å®šã‚’ã„ã¤èª°ãŒå¤‰æ›´ã—ãŸã‹</li>
<li>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨˜éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™</li>
</ul>
</li>
<li>ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆ <ul>
<li>ãƒ‡ãƒ¼ã‚¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ“ä½œã® API ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</li>
<li>ä¾‹ï¼šS3 ãƒã‚±ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿æ“ä½œã‚’ã„ã¤èª°ãŒè¡Œã£ãŸã‹</li>
<li>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯è¨˜éŒ²ãŒã€ŒOFFã€ã«ãªã£ã¦ã„ã¾ã™</li>
</ul>
</li>
<li>Insights ã‚¤ãƒ™ãƒ³ãƒˆ <ul>
<li>çŸ­æœŸé–“ã®éå‰°ãª API å‘¼ã³å‡ºã—ãªã©ã€éå»ã® API ä½¿ç”¨çŠ¶æ³ã®æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã£ã¦å¾—ã‚‰ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆã®ç•°å¸¸ãª API ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’æ¤œå‡º</li>
<li>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯è¨˜éŒ²ãŒã€ŒOFFã€ã«ãªã£ã¦ã„ã¾ã™</li>
</ul>
</li>
</ul>
<p>ã“ã‚Œã‚‰ã®ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã‹ã‚‰å±¥æ­´ã‚’å‚ç…§ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã€90 æ—¥é–“ã®å±¥æ­´ã¯ç„¡æ–™ã¨ãªã£ã¦ã„ã¾ã™ã€‚ ãã‚Œä»¥ä¸Šä¿å­˜ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„è¦ä»¶ãŒã‚ã‚‹å ´åˆã¯ã€åˆ¥é€” S3 ã‚„ CloudWatch Logs ã¸ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹è¨­å®šã‚’è¡Œã£ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p>CloudTrail ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²ã®å¤§éƒ¨åˆ†ã¯ã€ã€Œç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆã€ã¨ã€Œãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆã€ã«ãªã‚Šã¾ã™ã€‚</p>
<p>Insights ã‚¤ãƒ™ãƒ³ãƒˆã«ã¤ã„ã¦ã¯ã€<a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/logging-insights-events-with-cloudtrail.html" target="_blank">AWS ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a> ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
<p><a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/cloudtrail-tutorial.html" target="_blank">AWS CloudTrail ã®é–‹å§‹æ–¹æ³•ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</a> ã‚’å®Ÿæ–½ã—ã¦ã€ç†è§£ã‚’æ·±ã‚ã‚‹ã®ã‚‚ãŠã™ã™ã‚ã§ã™ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆ" duration="2">
        <p>ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã™ã¹ã¦ã®ç®¡ç†æ“ä½œã¨ã€ã»ã¼ã™ã¹ã¦ã®é API ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå«ã¾ã‚Œã¾ã™ã€‚ é API ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆAwsConsoleSignInï¼‰ãªã©ã§ã™ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆ" duration="2">
        <p>AWS IAM ãƒ­ãƒ¼ãƒ«ã€Amazon EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€Amazon S3 ãƒã‚±ãƒƒãƒˆã€AWS Lambda é–¢æ•°ãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ã¾ãŸã¯ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã¾ãŸã¯å†…éƒ¨ã§å®Ÿè¡Œã•ã‚Œã‚‹æ“ä½œãŒå«ã¾ã‚Œã¾ã™ã€‚ ã“ã‚Œã‚‰ã®æ“ä½œã¯ã€AWS ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã—ã¦æ§‹ç¯‰ã—ãŸã‚·ã‚¹ãƒ†ãƒ ã®å¤šãã®å ´åˆã§å¤§é‡ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒç™ºç”Ÿã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç„¡åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="CloudTrail ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«åã®å½¢å¼" duration="2">
        <p><a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/cloudtrail-log-file-examples.html#cloudtrail-log-filename-format" target="_blank">CloudTrail ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«åã®å½¢å¼</a></p>
<p>ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ¬¡ã®ã‚ˆã†ãªåç§°ã§å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚</p>
<pre><code language="language-text" class="language-text">AccountID_CloudTrail_RegionName_YYYYMMDDTHHmmZ_UniqueString.FileNameFormat
</code></pre>
<p>S3 ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸå ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
<pre><code language="language-text" class="language-text">111122223333_CloudTrail_us-east-2_20150801T0210Z_Mu0KsOhtH1ar15ZZ.json.gz
</code></pre>
<p class="image-container"><img alt="cloudtrail-s3" src="img\\58b08bed4d7f796.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="ãƒ­ã‚°ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ" duration="3">
        <p><a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/cloudtrail-log-file-examples.html#cloudtrail-log-file-examples-section" target="_blank">ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹</a></p>
<p>ConsoleLogin æ™‚ã®ä¾‹ã§ã™ã€‚</p>
<pre><code language="language-json" class="language-json">{
  &#34;eventVersion&#34;: &#34;1.08&#34;,
  &#34;userIdentity&#34;: {
    &#34;type&#34;: &#34;IAMUser&#34;,
    &#34;principalId&#34;: &#34;AIDAAAAAAAAAAAAAAAAAA&#34;,
    &#34;arn&#34;: &#34;arn:aws:iam::111111111111:user/Alice&#34;,
    &#34;accountId&#34;: &#34;111111111111&#34;,
    &#34;userName&#34;: &#34;Alice&#34;
  },
  &#34;eventTime&#34;: &#34;2023-04-05T01:14:33Z&#34;,
  &#34;eventSource&#34;: &#34;signin.amazonaws.com&#34;,
  &#34;eventName&#34;: &#34;ConsoleLogin&#34;,
  &#34;awsRegion&#34;: &#34;ap-northeast-1&#34;,
  &#34;sourceIPAddress&#34;: &#34;192.0.2.111&#34;,
  &#34;userAgent&#34;: &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36&#34;,
  &#34;requestParameters&#34;: null,
  &#34;responseElements&#34;: {
    &#34;ConsoleLogin&#34;: &#34;Success&#34;
  },
  &#34;additionalEventData&#34;: {
    &#34;LoginTo&#34;: &#34;https://ap-northeast-1.console.aws.amazon.com/console/home?xxxxx&#34;,
    &#34;MobileVersion&#34;: &#34;No&#34;,
    &#34;MFAIdentifier&#34;: &#34;arn:aws:iam::111111111111:mfa/Alice&#34;,
    &#34;MFAUsed&#34;: &#34;Yes&#34;
  },
  &#34;eventID&#34;: &#34;814cde86-2626-41ab-9557-6c7299981035&#34;,
  &#34;readOnly&#34;: false,
  &#34;eventType&#34;: &#34;AwsConsoleSignIn&#34;,
  &#34;managementEvent&#34;: true,
  &#34;recipientAccountId&#34;: &#34;111111111111&#34;,
  &#34;eventCategory&#34;: &#34;Management&#34;,
  &#34;tlsDetails&#34;: {
    &#34;tlsVersion&#34;: &#34;TLSv1.2&#34;,
    &#34;cipherSuite&#34;: &#34;ECDHE-RSA-AES128-GCM-SHA256&#34;,
    &#34;clientProvidedHostHeader&#34;: &#34;ap-northeast-1.signin.aws.amazon.com&#34;
  }
}
</code></pre>
<p>ã‚ˆãä½¿ã„ãã†ãªä¸»ãªé …ç›®ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚è©³ç´°ã¯<a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/cloudtrail-event-reference-record-contents.html" target="_blank">AWS ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
<ul>
<li>eventSource <ul>
<li>ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¡Œã‚ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã€‚ã“ã®åå‰ã¯é€šå¸¸ã€ã‚¹ãƒšãƒ¼ã‚¹ãªã—ã®ã‚µãƒ¼ãƒ“ã‚¹åã®çŸ­ç¸®å½¢ã« .amazonaws.com ã‚’ä»˜ã‘ãŸã‚‚ã® <ul>
<li>cloudformation.amazonaws.comã€ec2.amazonaws.comã€signin.amazonaws.com ãªã©</li>
</ul>
</li>
</ul>
</li>
<li>eventName <ul>
<li>ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚ãã®ã‚µãƒ¼ãƒ“ã‚¹ã® API ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã® 1 ã¤ã§ã™ã€‚ <ul>
<li>ConsoleLoginã€SwitchRoleã€CreateUserã€CreateVpc ãªã©</li>
</ul>
</li>
</ul>
</li>
<li>errorCode <ul>
<li>AWS ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¨ãƒ©ãƒ¼</li>
<li><a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/cloudtrail-log-file-examples.html#error-code-and-error-message" target="_blank">ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ­ã‚°ã®ä¾‹</a></li>
<li>ä¾‹ãˆã°ã€<code>AccessDenied</code> ã¨ã„ã£ãŸæ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¾ã™ã€‚</li>
</ul>
</li>
<li>errorMessage <ul>
<li>ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™å ´åˆã€ã‚¨ãƒ©ãƒ¼ã®èª¬æ˜</li>
<li><a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/cloudtrail-log-file-examples.html#error-code-and-error-message" target="_blank">ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ­ã‚°ã®ä¾‹</a></li>
<li>èªè¨¼å¤±æ•—ã®å ´åˆã¯ã€<code>Failed authentication</code> ãŒå«ã¾ã‚Œã¾ã™ã€‚</li>
</ul>
</li>
<li>additionalEventData <ul>
<li>ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ãŸã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¸€éƒ¨ã§ã¯ãªã„ã‚¤ãƒ™ãƒ³ãƒˆã«é–¢ã™ã‚‹è¿½åŠ ã®ãƒ‡ãƒ¼ã‚¿</li>
<li>ä¾‹ãˆã°ã€MFA ã‚’åˆ©ç”¨ã—ãŸã‹ã©ã†ã‹ã¯ <code>MFAUsed</code> ã«æ ¼ç´ã•ã‚Œã¾ã™ã€‚</li>
</ul>
</li>
<li>eventType <ul>
<li>ã‚¤ãƒ™ãƒ³ãƒˆãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ã‚¤ãƒ—</li>
<li>AwsApiCallã€AwsServiceEventã€AwsConsoleActionã€AwsConsoleSignInã€AwsCloudTrailInsight</li>
</ul>
</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="ç›£è¦–ã™ã‚‹ä¸»è¦ãªãƒ­ã‚°" duration="5">
        <p><a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/monitor-cloudtrail-log-files-with-cloudwatch-logs.html" target="_blank">Amazon CloudWatch Logs ã«ã‚ˆã‚‹ CloudTrail ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹</a></p>
<p><a href="https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/cloudwatch-alarms-for-cloudtrail.html" target="_blank">CloudTrail ã‚¤ãƒ™ãƒ³ãƒˆã® CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ ã®ä½œæˆ: ä¾‹</a></p>
<ul>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ <ul>
<li>ãƒ«ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½¿ç”¨ã‚’ç›£è¦– <ul>
<li><code>"{$.userIdentity.type=\"Root\" && $.userIdentity.invokedBy NOT EXISTS && $.eventType !=\"AwsServiceEvent\"}</code></li>
</ul>
</li>
<li>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®èªè¨¼å¤±æ•—ã‚’ç›£è¦– <ul>
<li><code>"{ ($.eventName = ConsoleLogin) && ($.errorMessage = \"Failed authentication\") }"</code></li>
</ul>
</li>
<li>ä»–è¦ç´ èªè¨¼ (MFA) ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’ç›£è¦– <ul>
<li><code>"{ $.eventName = \"ConsoleLogin\" && $.additionalEventData.MFAUsed = \"No\" }"</code></li>
</ul>
</li>
<li>IAM ãƒãƒªã‚·ãƒ¼ã‚„ãƒãƒªã‚·ãƒ¼ã¸ã®å¤‰æ›´ã‚’ç›£è¦– <ul>
<li><code>"{($.eventName=DeleteGroupPolicy)||($.eventName=DeleteRolePolicy)||($.eventName=DeleteUserPolicy)||($.eventName=PutGroupPolicy)||($.eventName=PutRolePolicy)||($.eventName=PutUserPolicy)||($.eventName=CreatePolicy)||($.eventName=DeletePolicy)||($.eventName=CreatePolicyVersion)||($.eventName=DeletePolicyVersion)||($.eventName=AttachRolePolicy)||($.eventName=DetachRolePolicy)||($.eventName=AttachUserPolicy)||($.eventName=DetachUserPolicy)||($.eventName=AttachGroupPolicy)||($.eventName=DetachGroupPolicy)}"</code></li>
</ul>
</li>
<li>IAM ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆã‚’ç›£è¦– <ul>
<li><code>"{($.eventName=CreateUser)||($.eventName=CreateLoginProfile)}"</code></li>
</ul>
</li>
<li>IAM ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã®ä½œæˆã‚’ç›£è¦– <ul>
<li><code>"{$.eventName=CreateAccessKey}"</code></li>
</ul>
</li>
<li>SwitchRole ã‚¨ãƒ©ãƒ¼ã®é€£ç¶šç™ºç”Ÿã‚’ç›£è¦– <ul>
<li><code>"{ $.eventSource = \"signin.amazonaws.com\" && $.eventName = \"SwitchRole\" && $.responseElements.SwitchRole= \"Failure\" }"</code></li>
</ul>
</li>
<li>ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’ç›£è¦– <ul>
<li><code>"{ ($.eventSource = \"s3.amazonaws.com\") && ($.eventName = \"StartSession\" || $.eventName = \"ResumeSession\" || $.eventName = \"TerminateSession\") }"</code></li>
</ul>
</li>
</ul>
</li>
<li>ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ <ul>
<li>CloudTrail ã®å¤‰æ›´ã‚’ç›£è¦– <ul>
<li><code>"{ ($.eventName = CreateTrail) || ($.eventName = UpdateTrail) || ($.eventName = DeleteTrail) || ($.eventName = StartLogging) || ($.eventName = StopLogging) }"</code></li>
</ul>
</li>
<li>GuardDuty æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ã®å‰Šé™¤ <ul>
<li><code>"{ ($.eventSource = \"guardduty.amazonaws.com\") && ($.eventName = \"DeleteDetector\") }"</code></li>
</ul>
</li>
<li>KMS ã‚­ãƒ¼ã®ç„¡åŠ¹ã¾ãŸã¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚ŒãŸå‰Šé™¤ã®ç™ºç”Ÿã‚’ç›£è¦– <ul>
<li><code>"{ $.eventSource = kms.amazonaws.com && ($.eventName = \"DisableKey\" || $.eventName = \"ScheduleKeyDeletion\") }"</code></li>
</ul>
</li>
<li>ç„¡åŠ¹ã¾ãŸã¯å‰Šé™¤ã•ã‚ŒãŸ KMS ã®ã‚­ãƒ¼ä½¿ç”¨æ™‚ã®ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã‚’ç›£è¦– <ul>
<li><code>"{ $.eventSource = kms.amazonaws.com && $.errorCode = \"*Exception\" }"</code></li>
</ul>
</li>
<li>ä¸æ­£ãª API å‘¼ã³å‡ºã—ã®ç™ºç”Ÿã‚’ç›£è¦– <ul>
<li><code>"{($.errorCode = "*UnauthorizedOperation" || $.errorCode = "AccessDenied*") && ($.eventName != "Decrypt" || $.userIdentity.invokedBy != "config.amazonaws.com" )}"</code></li>
</ul>
</li>
<li>EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆã€çµ‚äº†ã€èµ·å‹•ã€åœæ­¢ã€å†èµ·å‹• <ul>
<li><code>"{ ($.eventName = RunInstances) || ($.eventName = RebootInstances) || ($.eventName = StartInstances) || ($.eventName = StopInstances) || ($.eventName = TerminateInstances) }"</code></li>
</ul>
</li>
<li>ã‚µã‚¤ã‚ºã®å¤§ãã„ EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ (4x or 8x-large) ã®ä½œæˆã€çµ‚äº†ã€èµ·å‹•ã€åœæ­¢ã€å†èµ·å‹• <ul>
<li><code>"{ ($.eventName = RunInstances) && (($.requestParameters.instanceType = *.8xlarge) || ($.requestParameters.instanceType = *.4xlarge)) }"</code></li>
</ul>
</li>
</ul>
</li>
<li>ãƒã‚±ãƒƒãƒˆ <ul>
<li>S3 ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã¸ã®å¤‰æ›´ã‚’ç›£è¦– <ul>
<li><code>"{ ($.eventSource = \"s3.amazonaws.com\") && ($.eventName = \"PutBucketPolicy\") }"</code></li>
</ul>
</li>
<li>S3 ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ã®å‰Šé™¤ <ul>
<li><code>"{ ($.eventSource = \"s3.amazonaws.com\") && ($.eventName = \"DeleteAccountPublicAccessBlock\") }"</code></li>
</ul>
</li>
</ul>
</li>
<li>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ <ul>
<li>Amazon Virtual Private Cloud (VPC) ã®å¤‰æ›´ã‚’ç›£è¦– <ul>
<li><code>"{ ($.eventName = CreateVpc) || ($.eventName = DeleteVpc) || ($.eventName = ModifyVpcAttribute) || ($.eventName = AcceptVpcPeeringConnection) || ($.eventName = CreateVpcPeeringConnection) || ($.eventName = DeleteVpcPeeringConnection) || ($.eventName = RejectVpcPeeringConnection) || ($.eventName = AttachClassicLinkVpc) || ($.eventName = DetachClassicLinkVpc) || ($.eventName = DisableVpcClassicLink) || ($.eventName = EnableVpcClassicLink) }"</code></li>
</ul>
</li>
<li>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®å¤‰æ›´ã‚’ç›£è¦– <ul>
<li><code>"{ ($.eventName = CreateCustomerGateway) || ($.eventName = DeleteCustomerGateway) || ($.eventName = AttachInternetGateway) || ($.eventName = CreateInternetGateway) || ($.eventName = DeleteInternetGateway) || ($.eventName = DetachInternetGateway) }"</code></li>
</ul>
</li>
<li>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã¸ã®å¤‰æ›´ã‚’ç›£è¦– <ul>
<li><code>"{ ($.eventName = AuthorizeSecurityGroupIngress) || ($.eventName = AuthorizeSecurityGroupEgress) || ($.eventName = RevokeSecurityGroupIngress) || ($.eventName = RevokeSecurityGroupEgress) || ($.eventName = CreateSecurityGroup) || ($.eventName = DeleteSecurityGroup) }"</code></li>
</ul>
</li>
<li>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒªã‚¹ãƒˆ (ACL) ã®å¤‰æ›´ã‚’ç›£è¦– <ul>
<li><code>"{ ($.eventName = CreateNetworkAcl) || ($.eventName = CreateNetworkAclEntry) || ($.eventName = DeleteNetworkAcl) || ($.eventName = DeleteNetworkAclEntry) || ($.eventName = ReplaceNetworkAclEntry) || ($.eventName = ReplaceNetworkAclAssociation) }"</code></li>
</ul>
</li>
</ul>
</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="AWS CloudTrail ãƒ­ã‚°ã®ã‚¯ã‚¨ãƒªã® Athena ã«ã‚ˆã‚‹åˆ†æ" duration="2">
        <p><a href="https://docs.aws.amazon.com/ja_jp/athena/latest/ug/cloudtrail-logs.html" target="_blank">AWS CloudTrail ãƒ­ã‚°ã®ã‚¯ã‚¨ãƒª</a></p>
<p>CloudTrail ã®ãƒ­ã‚°ã‚’ Athena ã‚’ä½¿ã£ã¦åˆ†æã§ãã¾ã™ã€‚ CloudTrail ã®è¨¼è·¡ç”»é¢ã‚’é–‹ãã€ã€ŒAthena ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ <img alt="cloudtrail-athena-00" src="img\\8f7325d268e1fee5.png"></p>
<p>å¯¾è±¡ã® S3 ãƒã‚±ãƒƒãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚ <img alt="cloudtrail-athena-01" src="img\\50f67c26befb110b.png"></p>
<p>ã“ã‚Œã ã‘ã§ã€Athena ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚ <img alt="cloudtrail-athena-02" src="img\\15fc144943dd1cee.png"></p>
<p>ã‚¯ã‚¨ãƒªã‚¨ãƒ‡ã‚£ã‚¿ã§ã€SQL ã‚’ä½¿ã£ã¦åˆ†æã§ãã¾ã™ã€‚ ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ãªã€Œãƒ­ã‚°ã‚¤ãƒ³ãƒ¬ãƒãƒ¼ãƒˆã€ã‚’å‡ºåŠ›ã™ã‚‹ SQL ã§ã™ã€‚</p>
<pre><code language="language-sql" class="language-sql">SELECT
  eventTime,
  eventSource,
  eventName,
  awsRegion,
  sourceIPAddress,
  userIdentity.type,
  userIdentity.arn
FROM cloudtrail_logs_cloudtrail
WHERE eventName = &#39;ConsoleLogin&#39;
LIMIT 10;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="CloudTrail Lake" duration="2">
        <p>https://docs.aws.amazon.com/ja_jp/awscloudtrail/latest/userguide/cloudtrail-lake.html</p>
<p>ã“ã¡ã‚‰ã‚‚ã€Athena ã¨åŒæ§˜ã« SQL ã§åˆ†æã§ãã¾ã™ã€‚</p>
<p class="image-container"><img alt="cloudtrail-lake-00" src="img\\b08469dc40651152.png"></p>
<p class="image-container"><img alt="cloudtrail-lake-01" src="img\\3170ca73f1160afa.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="ğŸ“– ã¾ã¨ã‚" duration="0">
        <p class="image-container"><img alt="cloudtrail" src="img\\b36593c63db77694.png"></p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
